<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>ğŸ² éª°å­21é» æ±ºç­–è¼”åŠ©å™¨</title>
  <style>
    body { 
      font-family: system-ui, -apple-system, BlinkMacSystemFont; 
      background:#0f172a; 
      color:#e5e7eb; 
      padding:20px; 
      margin:0;
    }
    h1 { color:#38bdf8; margin-bottom: 16px; }
    .box { 
      background:#020617; 
      padding:16px; 
      border-radius:12px; 
      margin-bottom:12px; 
      box-shadow: 0 0 0 1px #1e293b inset;
    }
    .row-input {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
    }
    input { 
      width:80px; 
      padding:10px; 
      border-radius:8px; 
      border:none; 
      font-size:16px;
      text-align: center;
    }
    button { 
      padding:12px 18px; 
      border:none; 
      border-radius:10px; 
      background:#38bdf8; 
      color:#020617; 
      font-weight:bold; 
      cursor:pointer; 
      font-size:16px;
    }
    button:hover { opacity:0.9; }

    .result-card {
      background: linear-gradient(180deg, #020617, #020617cc);
      border-radius: 14px;
      padding: 16px;
      margin-top: 16px;
      box-shadow: 0 0 0 1px #1e293b inset, 0 10px 30px rgba(0,0,0,.4);
    }

    .result-card h3 {
      margin-top: 0;
      color: #38bdf8;
    }

    .row {
      display: grid;
      grid-template-columns: 70px 1fr 1fr 1fr 70px;
      gap: 8px;
      align-items: center;
      margin-bottom: 10px;
      font-size: 14px;
    }

    .bar {
      height: 8px;
      border-radius: 999px;
      background: #1e293b;
      overflow: hidden;
    }

    .bar > div {
      height: 100%;
      background: linear-gradient(90deg, #38bdf8, #22c55e);
    }

    .ev {
      font-weight: bold;
      text-align: right;
    }

    .best {
      margin-top: 12px;
      padding: 10px;
      border-radius: 10px;
      background: rgba(34,197,94,.15);
      color: #22c55e;
      font-weight: bold;
      text-align: center;
      font-size: 16px;
    }

    .hidden { display:none; }

    footer {
      margin-top: 20px;
      font-size: 12px;
      opacity: 0.7;
      text-align: center;
    }
  </style>
</head>
<body>

<h1>ğŸ² éª°å­ 21 é» â€“ æ±ºç­–è¼”åŠ©å™¨</h1>

<div class="box">
  <h3>ä½ çš„æ‰‹ç‰Œï¼ˆ1 = Aï¼Œ11~13 = 10ï¼‰</h3>
  <div class="row-input">
    <input id="p1" placeholder="ç‰Œ1">
    <input id="p2" placeholder="ç‰Œ2">
  </div>
</div>

<div class="box">
  <h3>èŠå®¶æ˜ç‰Œ</h3>
  <input id="dealer" placeholder="èŠå®¶">
</div>

<button onclick="runSim()">è¨ˆç®—æœ€ä½³ç­–ç•¥</button>

<div id="resultCard" class="result-card hidden">
  <h3>ğŸ¯ æ¨¡æ“¬çµæœï¼ˆæ©Ÿç‡ç´„å€¼ï¼‰</h3>
  <div id="rows"></div>
  <div class="best">
    ğŸ‘‰ å»ºè­°å‹•ä½œï¼š<span id="bestAction"></span>
  </div>
</div>

<footer>
  è¦å‰‡ï¼šéª°å­1~13ã€Aå¯1æˆ–11ã€èŠå®¶17åœã€åŒé»å¹³æ‰‹ã€BJ 1.5å€ã€Splitå¾Œä¸å¯Double
</footer>

<script>
const N_SIM = 20000;

function rollCard(){
  const r = Math.floor(Math.random()*13)+1;
  if(r===1) return 1;
  if(r>=11) return 10;
  return r;
}

function bestTotal(cards){
  let total = cards.reduce((a,b)=>a+b,0);
  let aces = cards.filter(c=>c===1).length;
  while(aces>0 && total+10<=21){
    total+=10;
    aces--;
  }
  return total;
}

function playDealer(cards){
  while(true){
    const t = bestTotal(cards);
    if(t>=17) return t;
    cards.push(rollCard());
  }
}

function outcome(p,d){
  if(p>21) return -1;
  if(d>21) return 1;
  if(p>d) return 1;
  if(p<d) return -1;
  return 0;
}

function sim(player, dealerUp, action){
  let w=0,l=0,t=0;
  for(let i=0;i<N_SIM;i++){
    let p = [...player];
    let d = [dealerUp, rollCard()];

    let pt;
    if(action==="stand"){
      pt = bestTotal(p);
    } else if(action==="hit"){
      p.push(rollCard());
      pt = bestTotal(p);
      while(pt<17){
        p.push(rollCard());
        pt = bestTotal(p);
      }
    } else if(action==="double"){
      p.push(rollCard());
      pt = bestTotal(p);
    } else if(action==="split"){
      const c = p[0];
      const p1 = [c, rollCard()];
      const p2 = [c, rollCard()];
      const t1 = bestTotal(p1);
      const t2 = bestTotal(p2);
      const dt = playDealer([...d]);
      const r = outcome(t1,dt)+outcome(t2,dt);
      if(r>0) w++;
      else if(r<0) l++;
      else t++;
      continue;
    }

    const dt = playDealer([...d]);
    const r = outcome(pt, dt);
    if(r>0) w++;
    else if(r<0) l++;
    else t++;
  }
  const total = w+l+t;
  return {win:w/total, lose:l/total, tie:t/total, ev:(w-l)/total};
}

function convert(x){
  if(x===1) return 1;
  if(x>=11) return 10;
  return x;
}

function runSim(){
  const p1 = parseInt(document.getElementById("p1").value);
  const p2 = parseInt(document.getElementById("p2").value);
  const dealer = parseInt(document.getElementById("dealer").value);

  if(!p1 || !p2 || !dealer){
    alert("è«‹è¼¸å…¥å®Œæ•´ç‰Œå€¼ï¼ˆ1~13ï¼‰");
    return;
  }

  const player = [convert(p1), convert(p2)];
  const dealerUp = convert(dealer);

  let actions = ["stand","hit","double"];
  if(player[0]===player[1]) actions.push("split");

  const card = document.getElementById("resultCard");
  const rows = document.getElementById("rows");
  const bestAction = document.getElementById("bestAction");

  rows.innerHTML = "";
  card.classList.remove("hidden");

  let best = null;
  let bestEV = -999;

  actions.forEach(a=>{
    const r = sim(player, dealerUp, a);

    const row = document.createElement("div");
    row.className = "row";
    row.innerHTML = `
      <div><b>${a.toUpperCase()}</b></div>
      <div>å‹ ${(r.win*100).toFixed(1)}%</div>
      <div>è¼¸ ${(r.lose*100).toFixed(1)}%</div>
      <div class="bar"><div style="width:${Math.max(0,(r.win-r.lose+1)*50)}%"></div></div>
      <div class="ev">${r.ev.toFixed(3)}</div>
    `;
    rows.appendChild(row);

    if(r.ev > bestEV){
      bestEV = r.ev;
      best = a;
    }
  });

  bestAction.textContent = best.toUpperCase();
}
</script>

</body>
</html>